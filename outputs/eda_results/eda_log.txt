
================================================================================
CULTURAL ALIGNMENT EDA PIPELINE
================================================================================
[15:06:47] Start time: 2025-11-19 15:06:47
[15:06:47] MODE: FULL DATASET ANALYSIS (NO SAMPLING)

================================================================================
PHASE 0: DATA LOADING
================================================================================
[15:06:47] Loading activation index...
  • Total sentences: 33522
  • Columns: ['row_id', 'sentence_num', 'sentence', 'group_type', 'state', 'attribute', 'base_correct', 'instruct_correct', 'activation_idx']
[15:06:47] Loading base layer 8...
  •   Shape: (33522, 1536)
[15:06:47] Loading base layer 16...
  •   Shape: (33522, 1536)
[15:06:47] Loading base layer 24...
  •   Shape: (33522, 1536)
[15:06:47] Loading base layer 28...
  •   Shape: (33522, 1536)
[15:06:47] Loading instruct layer 8...
  •   Shape: (33522, 1536)
[15:06:48] Loading instruct layer 16...
  •   Shape: (33522, 1536)
[15:06:48] Loading instruct layer 24...
  •   Shape: (33522, 1536)
[15:06:48] Loading instruct layer 28...
  •   Shape: (33522, 1536)

================================================================================
PHASE 1: TEXT QUALITY & SANITY
================================================================================

------------------------------------------------------------
1.1 Sentence Length Analysis
------------------------------------------------------------
[15:06:48] Length statistics by group:
[15:06:49] ✓ Saved length distribution plots

------------------------------------------------------------
1.2 Lexical Diversity Analysis
------------------------------------------------------------
[15:06:50] Lexical diversity by group:

------------------------------------------------------------
1.3 N-gram Frequency Analysis
------------------------------------------------------------
[15:06:51] 
SUPPRESSION - Top bigrams:
[15:06:51]   agricultural cycles, andhra pradesh, arunachal pradesh, community gatherings, dadra nagar, daman diu, haveli daman, high altitude, himachal pradesh, indian states
[15:06:52] 
ENHANCEMENT - Top bigrams:
[15:06:52]   agricultural cycles, andhra pradesh, arunachal pradesh, community gatherings, harvest celebrations, high altitude, himachal pradesh, indian cities, indian states, passed generations
[15:06:53] 
CONTROL - Top bigrams:
[15:06:53]   community gatherings, high altitude, indian cities, indian states, local guides, located telangana, national park, passed generations, south asia, stands apart

------------------------------------------------------------
1.4 Near-Duplicate Detection (FULL DATASET)
------------------------------------------------------------
[15:06:53] Computing TF-IDF similarity matrix for FULL dataset...
[15:06:53] This will take several minutes - please be patient...
[15:06:54] Computing pairwise similarities for all 33,522 sentences...
[15:06:54] Creating 33,522 × 33,522 similarity matrix...
[15:07:06] Identifying near-duplicate pairs (checking upper triangle only)...
[15:07:06]   Progress: 0/33,522 rows (0.0%)
[15:07:10]   Progress: 1,000/33,522 rows (3.0%)
[15:07:13]   Progress: 2,000/33,522 rows (6.0%)
[15:07:16]   Progress: 3,000/33,522 rows (8.9%)
[15:07:19]   Progress: 4,000/33,522 rows (11.9%)
[15:07:22]   Progress: 5,000/33,522 rows (14.9%)
[15:07:25]   Progress: 6,000/33,522 rows (17.9%)
[15:07:28]   Progress: 7,000/33,522 rows (20.9%)
[15:07:30]   Progress: 8,000/33,522 rows (23.9%)
[15:07:33]   Progress: 9,000/33,522 rows (26.8%)
[15:07:35]   Progress: 10,000/33,522 rows (29.8%)
[15:07:38]   Progress: 11,000/33,522 rows (32.8%)
[15:07:40]   Progress: 12,000/33,522 rows (35.8%)
[15:07:42]   Progress: 13,000/33,522 rows (38.8%)
[15:07:44]   Progress: 14,000/33,522 rows (41.8%)
[15:07:46]   Progress: 15,000/33,522 rows (44.7%)
[15:07:48]   Progress: 16,000/33,522 rows (47.7%)
[15:07:50]   Progress: 17,000/33,522 rows (50.7%)
[15:07:51]   Progress: 18,000/33,522 rows (53.7%)
[15:07:53]   Progress: 19,000/33,522 rows (56.7%)
[15:07:54]   Progress: 20,000/33,522 rows (59.7%)
[15:07:56]   Progress: 21,000/33,522 rows (62.6%)
[15:07:57]   Progress: 22,000/33,522 rows (65.6%)
[15:07:58]   Progress: 23,000/33,522 rows (68.6%)
[15:07:59]   Progress: 24,000/33,522 rows (71.6%)
[15:08:00]   Progress: 25,000/33,522 rows (74.6%)
[15:08:01]   Progress: 26,000/33,522 rows (77.6%)
[15:08:01]   Progress: 27,000/33,522 rows (80.5%)
[15:08:02]   Progress: 28,000/33,522 rows (83.5%)
[15:08:03]   Progress: 29,000/33,522 rows (86.5%)
[15:08:03]   Progress: 30,000/33,522 rows (89.5%)
[15:08:03]   Progress: 31,000/33,522 rows (92.5%)
[15:08:04]   Progress: 32,000/33,522 rows (95.5%)
[15:08:04]   Progress: 33,000/33,522 rows (98.4%)
[15:08:04]   Progress: 33,522/33,522 rows (100.0%)
  • Near-duplicate pairs found (FULL dataset): 0
[15:08:04] No near-duplicates found at threshold {config.SIMILARITY_THRESHOLD}!

================================================================================
PHASE 2: COVERAGE & BALANCE AUDIT
================================================================================

------------------------------------------------------------
2.1 Group Type Distribution
------------------------------------------------------------
[15:08:04] Sentence counts by group:
  • enhancement: 11,970 (35.7%)
  • suppression: 11,934 (35.6%)
  • control: 9,618 (28.7%)

------------------------------------------------------------
2.2 Cross-Tabulation Analysis
------------------------------------------------------------
[15:08:04] 
Group × State cross-tab shape: (3, 36)
[15:08:04] Cells with <30 sentences: 20
[15:08:04] 
Group × Attribute cross-tab shape: (3, 16)
[15:08:04] Cells with <30 sentences: 5

------------------------------------------------------------
2.3 State Coverage
------------------------------------------------------------
[15:08:04] 
Top 10 states by sentence count:
  • Telangana: 2,889
  • Uttarakhand: 1,806
  • Tamil_Nadu: 1,590
  • Sikkim: 1,485
  • Tripura: 1,449
  • Manipur: 1,449
  • Arunachal_Pradesh: 1,431
  • Himachal_Pradesh: 1,422
  • Jharkhand: 1,389
  • Karnataka: 1,308
[15:08:04] 
Bottom 10 states by sentence count:
  • Maharashtra: 534
  • Andaman_and_Nicobar: 474
  • Bihar: 447
  • Ladakh: 429
  • Goa: 405
  • Madhya_Pradesh: 390
  • Jammu_kashmir: 336
  • Kerala: 324
  • Chandigarh: 282
  • Lakshadweep: 171
[15:08:05] ✓ Saved state distribution plots

------------------------------------------------------------
2.4 Attribute Coverage
------------------------------------------------------------
[15:08:05] 
Attribute distribution:
  • Tourism: 5,613
  • History: 3,528
  • Cultural_Common_Sense: 3,363
  • Festivals: 3,267
  • Cuisine: 3,177
  • Dance_and_Music: 2,874
  • Art: 2,781
  • Costume: 2,103
  • Rituals_and_Ceremonies: 2,019
  • Language: 1,710
  • Personalities: 1,482
  • Religion: 888
  • Sports: 342
  • Transport: 183
  • Medicine: 135
  • Nightlife: 57
[15:08:06] ✓ Saved attribute distribution plot

------------------------------------------------------------
2.5 Model Correctness by Group
------------------------------------------------------------
[15:08:06] 
Correctness rates by group:
[15:08:06] ✓ Saved correctness plot

================================================================================
PHASE 3: SEMANTIC STRUCTURE EXPLORATION
================================================================================

------------------------------------------------------------
3.1 Generating Sentence Embeddings
------------------------------------------------------------
[15:08:06] Loading Sentence-BERT model...
[15:08:09] Encoding 33522 sentences (this will take a few minutes)...
  • Embedding shape: (33522, 384)
[15:08:18] Saved embeddings to /data/user_data/anshulk/cultural-alignment-study/eda_data/sentence_embeddings.npy

------------------------------------------------------------
3.2 UMAP Dimensionality Reduction
------------------------------------------------------------
[15:08:18] Running UMAP...
[15:08:47] Saved UMAP embeddings to /data/user_data/anshulk/cultural-alignment-study/eda_data/umap_2d.npy

------------------------------------------------------------
3.3 HDBSCAN Clustering
------------------------------------------------------------
[15:08:47] Running HDBSCAN...
  • Clusters found: 264
  • Noise points: 6612 (19.7%)

------------------------------------------------------------
3.4 Creating Visualizations
------------------------------------------------------------
[15:08:52] ✓ Saved UMAP visualizations

------------------------------------------------------------
3.5 Cluster Composition Analysis
------------------------------------------------------------
[15:08:52] Analyzed 264 clusters

------------------------------------------------------------
3.6 Baseline Probing on Embeddings
------------------------------------------------------------
[15:08:52] Training group_type probe...
  • Group type probe accuracy: 0.399 ± 0.025
[15:11:30] Training attribute probe...
  • Attribute probe accuracy: 0.775 ± 0.016

================================================================================
PHASE 4: ACTIVATION-LEVEL DEEP DIVE
================================================================================

------------------------------------------------------------
4.1 Activation Distribution Statistics
------------------------------------------------------------
[15:15:12] BASE Layer 8:
  •   Mean: 0.0180
  •   Std: 0.9196
  •   Per-dim std (mean): 0.1475
[15:15:13] BASE Layer 16:
  •   Mean: 0.0150
  •   Std: 1.0211
  •   Per-dim std (mean): 0.2056
[15:15:14] BASE Layer 24:
  •   Mean: 0.0222
  •   Std: 2.6712
  •   Per-dim std (mean): 0.7604
[15:15:14] BASE Layer 28:
  •   Mean: -0.0388
  •   Std: 4.0652
  •   Per-dim std (mean): 1.1090
[15:15:15] INSTRUCT Layer 8:
  •   Mean: 0.0181
  •   Std: 0.9068
  •   Per-dim std (mean): 0.1432
[15:15:16] INSTRUCT Layer 16:
  •   Mean: 0.0141
  •   Std: 1.0087
  •   Per-dim std (mean): 0.2012
[15:15:17] INSTRUCT Layer 24:
  •   Mean: 0.0195
  •   Std: 2.6060
  •   Per-dim std (mean): 0.7402
[15:15:17] INSTRUCT Layer 28:
  •   Mean: -0.0206
  •   Std: 3.9933
  •   Per-dim std (mean): 1.1544
[15:15:19] Saved activation std plots

------------------------------------------------------------
4.2 Group Centroid Analysis
------------------------------------------------------------
[15:15:19] 
BASE Layer 8 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9999, eucl=0.59
  •   suppression_vs_control: cos=0.9999, eucl=0.59
  •   enhancement_vs_control: cos=0.9998, eucl=0.78
[15:15:19] 
BASE Layer 16 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9998, eucl=0.75
  •   suppression_vs_control: cos=0.9997, eucl=0.88
  •   enhancement_vs_control: cos=0.9996, eucl=1.08
[15:15:19] 
BASE Layer 24 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9996, eucl=2.90
  •   suppression_vs_control: cos=0.9995, eucl=3.26
  •   enhancement_vs_control: cos=0.9991, eucl=4.38
[15:15:19] 
BASE Layer 28 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9996, eucl=4.26
  •   suppression_vs_control: cos=0.9995, eucl=4.92
  •   enhancement_vs_control: cos=0.9991, eucl=6.57
[15:15:19] 
INSTRUCT Layer 8 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9999, eucl=0.58
  •   suppression_vs_control: cos=0.9999, eucl=0.57
  •   enhancement_vs_control: cos=0.9998, eucl=0.76
[15:15:19] 
INSTRUCT Layer 16 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9999, eucl=0.73
  •   suppression_vs_control: cos=0.9998, eucl=0.85
  •   enhancement_vs_control: cos=0.9997, eucl=1.04
[15:15:19] 
INSTRUCT Layer 24 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9996, eucl=2.80
  •   suppression_vs_control: cos=0.9995, eucl=3.16
  •   enhancement_vs_control: cos=0.9991, eucl=4.26
[15:15:20] 
INSTRUCT Layer 28 - Group Distances:
  •   suppression_vs_enhancement: cos=0.9996, eucl=4.36
  •   suppression_vs_control: cos=0.9994, eucl=5.08
  •   enhancement_vs_control: cos=0.9990, eucl=6.83
[15:15:20] Saved group distance plots

------------------------------------------------------------
4.3 UMAP on Activation Space
------------------------------------------------------------
[15:15:20] Running UMAP on base layer 8...
[15:15:39] ✓ Saved UMAP visualization for base layer 8
[15:15:39] Running UMAP on base layer 16...
[15:15:57] ✓ Saved UMAP visualization for base layer 16
[15:15:57] Running UMAP on base layer 24...
[15:16:15] ✓ Saved UMAP visualization for base layer 24
[15:16:15] Running UMAP on base layer 28...
[15:16:32] ✓ Saved UMAP visualization for base layer 28
[15:16:32] Running UMAP on instruct layer 8...
[15:16:50] ✓ Saved UMAP visualization for instruct layer 8
[15:16:50] Running UMAP on instruct layer 16...
[15:17:09] ✓ Saved UMAP visualization for instruct layer 16
[15:17:09] Running UMAP on instruct layer 24...
[15:17:27] ✓ Saved UMAP visualization for instruct layer 24
[15:17:27] Running UMAP on instruct layer 28...
[15:17:44] ✓ Saved UMAP visualization for instruct layer 28

------------------------------------------------------------
4.3.5 HDBSCAN Clustering on Activation Space
------------------------------------------------------------
[15:17:44] 
============================================================
[15:17:44] Processing Layer 24
[15:17:44] ============================================================
[15:17:44] 
Running HDBSCAN on base layer 24 activations...
[15:17:45] BASE Layer 24:
  •   Clusters found: 136
  •   Noise points: 5998 (17.9%)
[15:17:45] ✓ Saved base layer 24 cluster composition to CSV
[15:17:45] 
BASE Layer 24 - Cluster purity analysis:
  •   Suppression-pure clusters (>70%): 7 clusters, 608 sentences
  •   Enhancement-pure clusters (>70%): 5 clusters, 542 sentences
  •   Control-pure clusters (>70%): 6 clusters, 428 sentences
  •   Average cluster purity: 53.6%
[15:17:45] 
Running HDBSCAN on instruct layer 24 activations...
[15:17:46] INSTRUCT Layer 24:
  •   Clusters found: 172
  •   Noise points: 7566 (22.6%)
[15:17:46] ✓ Saved instruct layer 24 cluster composition to CSV
[15:17:46] 
INSTRUCT Layer 24 - Cluster purity analysis:
  •   Suppression-pure clusters (>70%): 6 clusters, 449 sentences
  •   Enhancement-pure clusters (>70%): 6 clusters, 551 sentences
  •   Control-pure clusters (>70%): 4 clusters, 308 sentences
  •   Average cluster purity: 52.8%
[15:17:46] 
Layer 24 - Cross-model cluster comparison:
  •   Sentences in non-noise clusters (both models): 23011
  •   Same cluster ID in both models: 261 (1.1%)
[15:17:49] ✓ Saved activation cluster comparison plot for layer 24
[15:17:49] 
============================================================
[15:17:49] Processing Layer 28
[15:17:49] ============================================================
[15:17:49] 
Running HDBSCAN on base layer 28 activations...
[15:17:50] BASE Layer 28:
  •   Clusters found: 144
  •   Noise points: 8003 (23.9%)
[15:17:50] ✓ Saved base layer 28 cluster composition to CSV
[15:17:50] 
BASE Layer 28 - Cluster purity analysis:
  •   Suppression-pure clusters (>70%): 3 clusters, 255 sentences
  •   Enhancement-pure clusters (>70%): 5 clusters, 565 sentences
  •   Control-pure clusters (>70%): 7 clusters, 501 sentences
  •   Average cluster purity: 52.1%
[15:17:50] 
Running HDBSCAN on instruct layer 28 activations...
[15:17:50] INSTRUCT Layer 28:
  •   Clusters found: 156
  •   Noise points: 7893 (23.5%)
[15:17:50] ✓ Saved instruct layer 28 cluster composition to CSV
[15:17:50] 
INSTRUCT Layer 28 - Cluster purity analysis:
  •   Suppression-pure clusters (>70%): 8 clusters, 603 sentences
  •   Enhancement-pure clusters (>70%): 8 clusters, 847 sentences
  •   Control-pure clusters (>70%): 8 clusters, 576 sentences
  •   Average cluster purity: 53.6%
[15:17:50] 
Layer 28 - Cross-model cluster comparison:
  •   Sentences in non-noise clusters (both models): 21964
  •   Same cluster ID in both models: 305 (1.4%)
[15:17:53] ✓ Saved activation cluster comparison plot for layer 28

------------------------------------------------------------
4.4 Base vs Instruct Comparison
------------------------------------------------------------
[15:17:54] 
Layer 8 Base-Instruct Similarity:
  •   Overall: 0.9997 ± 0.0001
  •   suppression: 0.9997 ± 0.0001
  •   enhancement: 0.9997 ± 0.0001
  •   control: 0.9997 ± 0.0001
[15:17:54] 
Layer 16 Base-Instruct Similarity:
  •   Overall: 0.9993 ± 0.0002
  •   suppression: 0.9993 ± 0.0002
  •   enhancement: 0.9992 ± 0.0002
  •   control: 0.9993 ± 0.0002
[15:17:54] 
Layer 24 Base-Instruct Similarity:
  •   Overall: 0.9990 ± 0.0002
  •   suppression: 0.9990 ± 0.0002
  •   enhancement: 0.9990 ± 0.0002
  •   control: 0.9990 ± 0.0002
[15:17:54] 
Layer 28 Base-Instruct Similarity:
  •   Overall: 0.9970 ± 0.0005
  •   suppression: 0.9970 ± 0.0005
  •   enhancement: 0.9970 ± 0.0005
  •   control: 0.9969 ± 0.0005
[15:17:56] ✓ Saved base-instruct similarity plots

================================================================================
PHASE 5: MANUAL VALIDATION SAMPLING
================================================================================
[15:17:56] Generating stratified sample of 1000 sentences...
  • Sample size: 990
  • Distribution: {'suppression': 330, 'enhancement': 330, 'control': 330}
[15:17:56] ✓ Saved to /home/anshulk/cultural-alignment-study/outputs/eda_results/tables/manual_validation_sample.csv
[15:17:56] 
Instructions for manual validation:
[15:17:56] 1. Open manual_validation_sample.csv
[15:17:56] 2. For each sentence, fill in:
[15:17:56]    - manual_factual_correct: yes/no/unsure
[15:17:56]    - manual_cultural_specific: yes/no (is it truly about the culture?)
[15:17:56]    - manual_style_issues: list any repetitive/generic phrasing
[15:17:56]    - manual_notes: any other observations

================================================================================
GENERATING SUMMARY REPORT
================================================================================
[15:17:56] ✓ Summary report saved
[15:17:56] ✓ Saved enhanced dataset to /home/anshulk/cultural-alignment-study/outputs/eda_results/tables/enhanced_dataset.csv

================================================================================
PIPELINE COMPLETE
================================================================================
[15:17:56] End time: 2025-11-19 15:17:56
[15:17:56] Total duration: 11.1 minutes
[15:17:56] 
All outputs saved to:
[15:17:56]   /home/anshulk/cultural-alignment-study/outputs/eda_results
[15:17:56]   /data/user_data/anshulk/cultural-alignment-study/eda_data
